<?php
function isWeekend($date) {
    $weekDay = date('w', strtotime($date));
    return ($weekDay == 0);
}
function findKeyValue($key,$value,$data){
    foreach ($data as $item){
        if($item[$key] == $value){
            return $item;
        }
    }
    return '';
}
?>
<div class="container-fluid">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-primary">
                        <h4 class="card-title">1651120140 - Huỳnh Công Trang</h4>
                        <p class="card-category">PHP Dev</p>
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="row">
                                <div class="col-md-10">
                                    <div class="form-group">
                                        <label class="bmd-label-floating">Month</label>
                                        <input type="text" class="form-control date" value="03/2020">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary pull-right">Search</button>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <h6>Statastic timing</h6>
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="">
                                <th>
                                    Số ngày đi làm
                                </th>
                                <th>
                                    Số ngày nghĩ
                                </th>
                                <th>
                                    Số lần quên chấm công
                                </th>
                                <th>
                                    Tổng thời gian đi trể
                                </th>
                                <th>
                                    Số ngày phạt
                                </th>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            1
                                        </td>
                                        <td>
                                            2
                                        </td>
                                        <td>
                                            3
                                        </td>
                                        <td>
                                            4
                                        </td>
                                        <td>
                                            5
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <h6>Dashboard my timing</h6>
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead class="text-primary">
                                <th>
                                    Ngày
                                </th>
                                <th>
                                    Giờ vào
                                </th>
                                <th>
                                    Giờ ra
                                </th>
                                <th>
                                    Ngày làm
                                </th>
                                <th>
                                    Lý do
                                </th>
                                <th>
                                    Ghi chú
                                </th>
                                <th>
                                    Hành động
                                </th>
                                </thead>
                                <tbody>
                                    <?php if(isset($this->all_date)) foreach ($this->all_date as $item):?>
                                    <tr <?php if(isWeekend($item['Date'])){
                                        echo 'class="background-break" title="Hôm nay là chủ nhật"';
                                    }else if(in_array($item['Date'], $this->day_all_advance) && $this->day_advance[$item['Date']] == 0){
                                        echo 'class="background-break" title="Hôm nay là ngày nghĩ"';
                                    }else if(in_array($item['Date'], $this->day_all_advance) && $this->day_advance[$item['Date']] != 0){
                                        echo 'class="background-break" title="Hôm nay được nghĩ nữa ngày"';
                                    }?>>
                                        <?php 
                                            $check_in_at = '' ;
                                            $check_out_at = '' ;
                                            $count_work = '' ;
                                            $reason = '' ;
                                            $note = '' ;
                                            $action = array();//1,2,3: bosungcong,dangkiphep,xacnhantresom
                                        ?>
                                        <?php if(isset($this->detail_timing[$item['Date']])){
                                            $find = findKeyValue('type', 1, $this->detail_timing[$item['Date']]);
                                            if(!empty($find)){
                                                $check_in_at = $find['check_in_at'];
                                                $check_out_at = $find['check_out_at'];
                                                //phan sau tinh gio
                                            }
                                        }?>
                                        <td>
                                            <?php echo date_format(date_create($item['Date']), 'l, d-m-Y')?>
                                        </td>
                                        <td>
                                            <?php echo $check_in_at?>
                                        </td>
                                        <td>
                                            <?php echo $check_out_at?>
                                        </td>
                                        <td>
                                            <?php echo $count_work?>
                                        </td>
                                        <td>
                                            <?php echo $reason?>
                                        </td>
                                        <td>
                                            <?php echo $note?>
                                        </td>
                                        <td>
                                            <div class="dropdown show">
                                                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    Action
                                                </a>

                                                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                    <a class="dropdown-item" href="#">Bổ sung công</a>
                                                    <a class="dropdown-item" href="#">Đăng kí phép</a>
                                                    <a class="dropdown-item" href="#">Xác nhận đi trể/về sớm</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <?php endforeach;?>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>